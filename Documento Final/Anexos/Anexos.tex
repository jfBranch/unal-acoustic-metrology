%  ╔═╗┌┐┌┌─┐─┐ ┬┌─┐┌─┐
%  ╠═╣│││├┤ ┌┴┬┘│ │└─┐
%  ╩ ╩┘└┘└─┘┴ └─└─┘└─┘

\begin{appendix}

\chapter{Anexo: Códigos de Python y subrutinas GRAFCET}

\begin{code}
	\caption{Código para presentar resultados del procesamiento de una muestra del número $5$ del conjunto de imágenes entrenamiento.}
	\label{code:test_samples_code}
	\centering
	\inputminted{python}{3_Reconocimiento/Codes/image_processing_test.py}
\end{code}

\begin{code}
	\caption{Código para realizar la extracción de características de los vectores de entrenamiento y para entrenar el clasificador.}
	\label{code:features_extracting}
	\centering
	\inputminted{python}{3_Reconocimiento/Codes/features_extracting.py}
\end{code}

\begin{code}
\caption{Código para realizar la extracción de características de los vectores de prueba y para realizar la clasificación.}
\label{code:sample_classifying}
\centering
\begin{minted}{python}
X = np.array(X)  # Convert test sample features vector to numpy array
# -------- DIMENSIONALITY REDUCTION BY KERNEL PCA --------- #
X = kpcaModel.transform(X)
# ------- CLASSIFY ---------#
y_hat = gnbClassifier.predict(X)

\end{minted}
\end{code}

\begin{code}
\caption{Código para generar la matriz de confusión del clasificador bayesiano normal.}
\label{code:confusion_matrix}
\centering
\begin{minted}{python}
from sklearn.metrics import confusion_matrix, ConfusionMatrixDisplay

# -------------- CLASSIFICATION ACCURACY --------------
cm = confusion_matrix(y_test, y_hat, labels=gnbClassifier.classes_)
disp = ConfusionMatrixDisplay(confusion_matrix=cm, display_labels=gnbClassifier.classes_)
disp.plot()
plt.show()
\end{minted}
\end{code}

\begin{sidewaysfigure}[!hp]
    \caption{GRAFCET's de las subrutinas para la calibración periódica de calibradores acústicos.}
    \label{fig:GRAFCET_subrutines}
    \begin{subfigure}[t]{0.48\textwidth}
        \caption{Subrutina para la etapa macro $1$: Medición preeliminar de sensibilidad del micrófono.}
        \label{fig:GRAFCET_micsens}
        \centering
        \begin{tikzpicture}[font=\scriptsize]
            \begin{Encap}{0,0}{M1}{Mic Sensibility Measurement}
                \Etape[0,0]{E1}
                \ActionX{XE1}{\tiny $\texttt{CoupledRefCal} \defeq 1$}
                \ActionActiv{XE1}
                \Action{XE1}{\tiny \texttt{RefCalPower} $\defeq 1$}
                \ActionEvenement{XE1}{\tiny $\uparrow\texttt{CoupledRefCal}$}
                \TransitionRecept[VXE1]{E1}{\tiny $\texttt{RefCalPower} \cdot \texttt{CoupledRefCal} \cdot \texttt{Ok}$}
                \node(TE1') [below=0cm of VXE1]{}; \node(VTE1')[below=2em of TE1']{}; \draw (TE1') -- (VTE1');
                \DecaleNoeudx[11]{TE1'}{TE1r}
                \DecaleNoeudx[11]{VTE1}{VTE1r}
                \ConvOU{TE1'}{TE1r}{L20}
                \Etape[L20]{20}
                \ActionX{X20}{\tiny \texttt{MeasMicSens}}
                \ActionCond{X20}{\tiny $\qty{10}{\s}$/\texttt{X20}}
                \Action{X20}{\tiny \texttt{MeasFinished}}
                \ActionCond{X20}{\tiny $\qty{5}{\s}$/\texttt{MeasMicSens}}
                \DivOU{X20}{-4/L20a, 5/L20b}
                \Transition[L20a]{20a}
                \node[right=0.1 of L20a, align=left]{\tiny $\texttt{MeasFinished} \cdot$ \\ \tiny $[\qty{380}{\mV} \le \mathit{Sens} \le \qty{460}{\mV}]$};
                \Transition[L20b]{20b}
                \node [right=0.1 of L20b, align=left]
                {\tiny $\texttt{MeasFinished} \cdot$ \\ \tiny $([\qty{380}{\mV} \ge \mathit{Sens}] +$ \\ \tiny $[\mathit{Sens} \ge \qty{480}{\mV}])$};
                \Etape[VT20b]{21}
                \ActionX{X21}{\tiny \texttt{RepeatDialog}}
                \DivOU{X21}{-3/L21a,3/L21b}
                \TransitionRecept[L21a]{21a}{\tiny $\texttt{X21} \cdot \overline{\texttt{Ok}}$}
                \TransitionRecept[L21b]{21b}{\tiny $\texttt{X21} \cdot \texttt{Ok}$}
                \node (paso) [right=1em of TE1r]{};
                \Lien{T21b}{paso}{VTE1r}
                \Etape[VT21a]{22}
                \node[right=0.2 of X22, align=center]{\textit{``Suspende la} \\ \textit{secuencia principal''}};
                \DecaleNoeudy[8.8]{L20a}{nS1}
                \Etape[nS1]{S1}
                \draw (L20a) -- (XS1);
            \end{Encap}
        \end{tikzpicture}
        \caption*{\footnotesize Fuente: Elaboración propia.}
    \end{subfigure}
    \hfill
    \begin{subfigure}[t]{0.48\textwidth}
        \caption{Subrutina para la etapa macro $2$: Medición de ruido de fondo a $\qty{5}{\degree}$ con el calibrador patrón.}
        \label{fig:GRAFCET_standard_noise0}
        \centering
        \begin{tikzpicture}[font=\scriptsize]
            \begin{Encap}{0,0}{M2}{Background Noise Standard Calibrator}
                \Etape[0,0]{E2}
                \ActionX{XE2}{\tiny $\texttt{RefCalOrient} \defeq 0$}
                \ActionActiv{XE2}
                \Action{XE2}{\tiny \texttt{RefCalPower} $\defeq 0$}
                \ActionEvenement{XE2}{\tiny $\uparrow\texttt{RotatedRefCal}$}
                \TransitionRecept[VXE2]{E2}{\tiny $\overline{\texttt{RefCalPower}} \cdot \texttt{CoupledRefCal} \cdot \texttt{Ok}$}
                \node(TE2') [below=0cm of VXE2]{}; \node(VTE2')[below=2em of TE2']{}; \draw (TE2') -- (VTE2');
                \DecaleNoeudx[11]{TE2'}{TE2r}
                \DecaleNoeudx[11]{VTE2}{VTE2r}
                \ConvOU{TE2'}{TE2r}{L23}
                \Etape[L23]{23}
                \ActionX{X23}{\tiny \texttt{MeasBackNoise}}
                \ActionCond{X23}{\tiny $\qty{3}{\s}$/\texttt{X23}}
                \Action{X23}{\tiny \texttt{MeasFinished}}
                \ActionCond{X23}{\tiny $\qty{7}{\s}$/\texttt{MeasBackNoise}}
                \DivOU{X23}{-4/L23a, 4.5/L23b}
                \Transition[L23a]{23a}
                \node[right=0.1 of L23a, align=left]
                {\tiny $\texttt{MeasFinished} \cdot$ \\ \tiny $[\mathit{Noise} \le L_{\mathrm{spec}} - \qty{30}{\dB}]$};
                \Transition[L23b]{23b}
                \node [right=0.1 of L23b, align=left]
                {\tiny $\texttt{MeasFinished} \cdot$ \\ \tiny $[\mathit{Noise} \ge L_{\mathrm{spec}} - \qty{30}{\dB}]$};
                \Etape[VT23b]{24}
                \ActionX{X24}{\tiny \texttt{RepeatDialog}}
                \DivOU{X24}{-3/L24a,3/L24b}
                \TransitionRecept[L24a]{24a}{\tiny $\texttt{X24} \cdot \overline{\texttt{Ok}}$}
                \TransitionRecept[L24b]{24b}{\tiny $\texttt{X24} \cdot \texttt{Ok}$}
                \node (paso) [right=2em of TE2r]{};
                \Lien{T24b}{paso}{VTE2r}
                \Etape[VT24a]{25}
                \node[right=0.2 of X25, align=center]{\textit{``Suspende la} \\ \textit{secuencia principal''}};
                \DecaleNoeudy[8.8]{L23a}{nS2}
                \Etape[nS2]{S2}
                \draw (L23a) -- (XS2);
            \end{Encap}
        \end{tikzpicture}
        \caption*{\footnotesize Fuente: Elaboración propia.}
    \end{subfigure}
\end{sidewaysfigure}
%
\begin{sidewaysfigure}[!hp]
    \ContinuedFloat
    \caption{GRAFCET's de las subrutinas para la calibración periódica de calibradores acústicos (continuación).}
    \begin{subfigure}[t]{0.33\textwidth}
        \caption{Subrutina para las etapas macro $\numlist{3;6;9}$: Medición de magnitudes con el calibrador patrón.}
        \label{fig:GRAFCET_standard_quantities}
        \centering
        \begin{tikzpicture}[font=\scriptsize]
            \begin{Encap}{0,0}{M3 (M6 o M9)}{Quantities Measurement Standard Cal}
                \EtapeTransition[0,0]{E3}{\tiny $\texttt{RefCalPower} \defeq 1$}{\tiny $\texttt{RefCalPower} \cdot \texttt{Ok}$}
                \ActionActiv{XE3}
                \LienTE[3]{TE3}
                \EtapeTransition[VTE3]{26}{\tiny \texttt{MeasQuantities}}{\tiny \texttt{MeasFinished}}
                \ActionCond{X26}{\tiny $\qty{18}{\s}$/\texttt{X26}}
                \Action{X26}{\tiny \texttt{MeasFinished}}
                \ActionCond{X26}{\tiny $\qty{30}{\s}$/\texttt{MeasQuantities}}
                \Etape{S3}
            \end{Encap}
        \end{tikzpicture}
        \caption*{\footnotesize Fuente: Elaboración propia.}
    \end{subfigure}
    \hfill
    \begin{subfigure}[t]{0.55\textwidth}
        \caption{Subrutina para las etapas macro $\numlist{5; 8}$: Medición de ruido de fondo a $\qty{120}{\degree}$ y $\qty{240}{\degree}$ con el calibrador patrón.}
        \label{fig:GRAFCET_noise_standard}
        \centering
        \begin{tikzpicture}[font=\scriptsize]
            \begin{Encap}{0,0}{M5 (M8)}{Background Noise Standard Calibrator}
                \Etape[0,0]{E5}
                \ActionX{XE5}{\tiny $\texttt{RefCalOrient} \defeq \texttt{RefCalOrient} + 120$}
                \ActionActiv{XE5}
                \Action{XE5}{\tiny \texttt{CoupledRefCal} $\defeq 1$}
                \ActionEvenement{XE5}{\tiny $\uparrow\texttt{RotatedRefCal}$}
                \TransitionRecept[VXE5]{E5}{\tiny $\overline{\texttt{RefCalPower}} \cdot \texttt{CoupledRefCal} \cdot \texttt{Ok}$}
                \node(TE5') [below=0cm of VXE5]{}; \node(VTE5')[below=2em of TE5']{}; \draw (TE5') -- (VTE5');
                \DecaleNoeudx[11]{TE5'}{TE5r}
                \DecaleNoeudx[11]{VTE5}{VTE5r}
                \ConvOU{TE5'}{TE5r}{L27}
                \Etape[L27]{27}
                \ActionX{X27}{\tiny \texttt{MeasBackNoise}}
                \ActionCond{X27}{\tiny $\qty{3}{\s}$/\texttt{X27}}
                \Action{X27}{\tiny \texttt{MeasFinished}}
                \ActionCond{X27}{\tiny $\qty{7}{\s}$/\texttt{MeasBackNoise}}
                \DivOU{X27}{-4/L27a, 4.5/L27b}
                \Transition[L27a]{27a}
                \node[right=0.1 of L27a, align=left]
                {\tiny $\texttt{MeasFinished} \cdot$ \\ \tiny $[\mathit{Noise} \le L_{\mathrm{spec}} - \qty{30}{\dB}]$};
                \Transition[L27b]{27b}
                \node [right=0.1 of L27b, align=left]
                {\tiny $\texttt{MeasFinished} \cdot$ \\ \tiny $[\mathit{Noise} \ge L_{\mathrm{spec}} - \qty{30}{\dB}]$};
                \Etape[VT27b]{28}
                \ActionX{X28}{\tiny \texttt{RepeatDialog}}
                \DivOU{X28}{-3/L28a,3/L28b}
                \TransitionRecept[L28a]{28a}{\tiny $\texttt{X28} \cdot \overline{\texttt{Ok}}$}
                \TransitionRecept[L28b]{28b}{\tiny $\texttt{X28} \cdot \texttt{Ok}$}
                \node (paso) [right=2em of TE5r]{};
                \Lien{T28b}{paso}{VTE5r}
                \Etape[VT28a]{29}
                \node[right=0.2 of X29, align=center]{\textit{``Suspende la} \\ \textit{secuencia principal''}};
                \DecaleNoeudy[8.8]{L27a}{nS5}
                \Etape[nS5]{S5}
                \draw (L27a) -- (XS5);
            \end{Encap}
        \end{tikzpicture}
        \caption*{\footnotesize Fuente: Elaboración propia.}
    \end{subfigure}
\end{sidewaysfigure}
%
\begin{sidewaysfigure}[!hp]
    \ContinuedFloat
    \caption{GRAFCET's de las subrutinas para la calibración periódica de calibradores acústicos (continuación).}
    \begin{subfigure}[t]{0.48\textwidth}
        \caption{Subrutina para la etapa macro $11$: Medición de ruido de fondo a $\qty{0}{\degree}$ con el calibrador bajo prueba.}
        \label{fig:GRAFCET_noise0_dut}
        \centering
        \begin{tikzpicture}[font=\scriptsize]
            \begin{Encap}{0,0}{M11}{Background Noise Customer Calibrator}
                \Etape[0,0]{E11}
                \ActionX{XE11}{\tiny $\texttt{CusCalOrient} \defeq 0$}
                \ActionActiv{XE11}
                \Action{XE11}{\tiny \texttt{CusCalPower} $\defeq 0$}
                \ActionEvenement{XE11}{\tiny $\uparrow\texttt{RotatedRefCal}$}
                \TransitionRecept[VXE11]{E11}{\tiny $\overline{\texttt{CusCalPower}} \cdot \texttt{CoupledCusCal} \cdot \texttt{Ok}$}
                \node(TE11') [below=0cm of VXE11]{}; \node(VTE11')[below=2em of TE11']{}; \draw (TE11') -- (VTE11');
                \DecaleNoeudx[11]{TE11'}{TE11r}
                \DecaleNoeudx[11]{VTE11}{VTE11r}
                \ConvOU{TE11'}{TE11r}{L30}
                \Etape[L30]{30}
                \ActionX{X30}{\tiny \texttt{MeasBackNoise}}
                \ActionCond{X30}{\tiny $\qty{3}{\s}$/\texttt{X30}}
                \Action{X30}{\tiny \texttt{MeasFinished}}
                \ActionCond{X30}{\tiny $\qty{7}{\s}$/\texttt{MeasBackNoise}}
                \DivOU{X30}{-4/L30a, 4.5/L30b}
                \Transition[L30a]{23a}
                \node[right=0.1 of L30a, align=left]
                {\tiny $\texttt{MeasFinished} \cdot$ \\ \tiny $[\mathit{Noise} \le L_{\mathrm{spec}} - \qty{30}{\dB}]$};
                \Transition[L30b]{30b}
                \node [right=0.1 of L30b, align=left]
                {\tiny $\texttt{MeasFinished} \cdot$ \\ \tiny $[\mathit{Noise} \ge L_{\mathrm{spec}} - \qty{30}{\dB}]$};
                \Etape[VT30b]{31}
                \ActionX{X31}{\tiny \texttt{RepeatDialog}}
                \DivOU{X31}{-3/L31a,3/L31b}
                \TransitionRecept[L31a]{31a}{\tiny $\texttt{X31} \cdot \overline{\texttt{Ok}}$}
                \TransitionRecept[L31b]{31b}{\tiny $\texttt{X31} \cdot \texttt{Ok}$}
                \node (paso) [right=2em of TE11r]{};
                \Lien{T31b}{paso}{VTE11r}
                \Etape[VT31a]{32}
                \node[right=0.2 of X32, align=center]{\textit{``Suspende la} \\ \textit{secuencia principal''}};
                \DecaleNoeudy[8.8]{L30a}{nS11}
                \Etape[nS11]{S11}
                \draw (L30a) -- (XS11);
            \end{Encap}
        \end{tikzpicture}
        \caption*{\footnotesize Fuente: Elaboración propia.}
    \end{subfigure}
    \hfill
    \begin{subfigure}[t]{0.48\textwidth}
        \caption{Subrutina para las etapas macro $\numlist{14;17}$: Medición de ruido de fondo a $\qty{120}{\degree}$ y $\qty{240}{\degree}$ con el calibrador bajo prueba.}
        \label{fig:GRAFCET_noise_dut}
        \centering
        \begin{tikzpicture}[font=\scriptsize]
            \begin{Encap}{0,0}{M14 (M17)}{Background Noise Customer Calibrator}
                \Etape[0,0]{E14}
                \ActionX{XE14}{\tiny $\texttt{CusCalOrient} \defeq \texttt{CusCalOrient} + 120$}
                \ActionActiv{XE14}
                \Action{XE14}{\tiny \texttt{CoupledCusCal} $\defeq 1$}
                \ActionEvenement{XE14}{\tiny $\uparrow\texttt{RotatedCusCal}$}
                \TransitionRecept[VXE14]{E14}{\tiny $\overline{\texttt{RefCalPower}} \cdot \texttt{CoupledCusCal} \cdot \texttt{Ok}$}
                \node(TE14') [below=0cm of VXE14]{}; \node(VTE14')[below=2em of TE14']{}; \draw (TE14') -- (VTE14');
                \DecaleNoeudx[11]{TE14'}{TE14r}
                \DecaleNoeudx[11]{VTE14}{VTE14r}
                \ConvOU{TE14'}{TE14r}{L34}
                \Etape[L34]{34}
                \ActionX{X34}{\tiny \texttt{MeasBackNoise}}
                \ActionCond{X34}{\tiny $\qty{3}{\s}$/\texttt{X34}}
                \Action{X34}{\tiny \texttt{MeasFinished}}
                \ActionCond{X34}{\tiny $\qty{7}{\s}$/\texttt{MeasBackNoise}}
                \DivOU{X34}{-4/L34a, 4.5/L34b}
                \Transition[L34a]{34a}
                \node[right=0.1 of L34a, align=left]
                {\tiny $\texttt{MeasFinished} \cdot$ \\ \tiny $[\mathit{Noise} \le L_{\mathrm{spec}} - \qty{30}{\dB}]$};
                \Transition[L34b]{34b}
                \node [right=0.1 of L34b, align=left]
                {\tiny $\texttt{MeasFinished} \cdot$ \\ \tiny $[\mathit{Noise} \ge L_{\mathrm{spec}} - \qty{30}{\dB}]$};
                \Etape[VT34b]{35}
                \ActionX{X35}{\tiny \texttt{RepeatDialog}}
                \DivOU{X35}{-3/L35a,3/L35b}
                \TransitionRecept[L35a]{35a}{\tiny $\texttt{X35} \cdot \overline{\texttt{Ok}}$}
                \TransitionRecept[L35b]{35b}{\tiny $\texttt{X35} \cdot \texttt{Ok}$}
                \node (paso) [right=2em of TE14r]{};
                \Lien{T35b}{paso}{VTE14r}
                \Etape[VT35a]{36}
                \node[right=0.2 of X36, align=center]{\textit{``Suspende la} \\ \textit{secuencia principal''}};
                \DecaleNoeudy[8.8]{L34a}{nS14}
                \Etape[nS14]{S14}
                \draw (L34a) -- (XS14);
            \end{Encap}
        \end{tikzpicture}
        \caption*{\footnotesize Fuente: Elaboración propia.}
    \end{subfigure}
\end{sidewaysfigure}
%
\clearpage
\begin{figure}[!ht]
    \ContinuedFloat
    \caption{GRAFCET's de las subrutinas para la calibración periódica de calibradores acústicos (continuación).}
    \begin{subfigure}[t]{\textwidth}
        \caption{Subrutina para las etapas macro $\numlist{12;15;18}$: Medición de magnitudes con el calibrador bajo prueba.}
        \label{fig:GRAFCET_dut_quantities}
        \centering
        \begin{tikzpicture}[font=\scriptsize]
            \begin{Encap}{0,0}{M12 (M15 o M18)}{Quantities Measurement Customer Cal}
                \EtapeTransition[0,0]{E12}{\tiny $\texttt{CusCalPower} \defeq 1$}{\tiny $\texttt{CusCalPower} \cdot \texttt{Ok}$}
                \ActionActiv{XE12}
                \LienTE[3]{TE12}
                \EtapeTransition[VTE12]{33}{\tiny \texttt{MeasQuantities}}{\tiny \texttt{MeasFinished}}
                \ActionCond{X33}{\tiny $\qty{18}{\s}$/\texttt{X33}}
                \Action{X33}{\tiny \texttt{MeasFinished}}
                \ActionCond{X33}{\tiny $\qty{30}{\s}$/\texttt{MeasQuantities}}
                \Etape{S12}
            \end{Encap}
        \end{tikzpicture}
        \caption*{\footnotesize Fuente: Elaboración propia.}
    \end{subfigure}
\end{figure}
\end{appendix}